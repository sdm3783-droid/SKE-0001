<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SKE-0001 ë°œì£¼ ìƒì„±ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 pb-6 border-b-2 border-slate-200">
            <div>
                <h2 class="text-2xl font-bold text-blue-800 border-l-8 border-blue-800 pl-4 uppercase">SKE-0001 Order System</h2>
                <p class="text-slate-500 text-sm mt-1">ê¸°ì¡´ ì¸ë²¤í† ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë°œì£¼ì„œë¥¼ ìë™ ì‘ì„±í•©ë‹ˆë‹¤.</p>
            </div>
            <a href="index.html" class="px-5 py-2 bg-white hover:bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold transition-all shadow-sm">â† ë©”ì¸ í˜„í™©íŒ</a>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <aside class="lg:col-span-4">
                <div class="card p-6">
                    <h3 class="text-[10px] font-black text-slate-400 mb-4 uppercase tracking-[0.2em]">Select Project Group</h3>
                    <div id="projectGroupList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2 text-sm font-medium">
                        </div>
                </div>
            </aside>

            <main id="workArea" class="lg:col-span-8 hidden">
                <div class="card overflow-hidden border-t-4 border-blue-600">
                    <div class="bg-slate-50 p-6 border-b border-slate-200 flex justify-between items-center">
                        <h2 class="text-lg font-bold text-slate-800" id="selectedTitle">ìƒì„¸ ì„¤ì •</h2>
                        <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded font-black uppercase">Auto Generated</span>
                    </div>

                    <div class="p-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 block mb-2 uppercase tracking-widest">Order Title</label>
                                <input type="text" id="newOrderName" class="w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none font-bold shadow-sm">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 block mb-2 uppercase tracking-widest">Multiplier (ë°°ìˆ˜)</label>
                                <div class="flex items-center gap-4">
                                    <input type="number" id="multiplier" value="1" min="1" class="w-24 border border-slate-200 rounded-xl p-3 text-center font-black text-blue-600 text-xl shadow-sm">
                                    <span class="text-slate-400 font-bold italic text-sm">X TIMES</span>
                                </div>
                            </div>
                        </div>

                        <div class="border border-slate-100 rounded-2xl mb-8 overflow-hidden bg-slate-50 shadow-inner">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-100 border-b border-slate-200 text-slate-500 font-black">
                                    <tr><th class="p-4">PART NAME</th><th class="p-4 text-right">BASE</th><th class="p-4 text-right text-blue-600">FINAL QTY</th></tr>
                                </thead>
                                <tbody id="previewBody" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="exportToPDF()" class="flex-1 bg-slate-900 hover:bg-black text-white font-black py-4 rounded-xl shadow-lg transition-all transform hover:-translate-y-1">PDF ë°œì£¼ì„œ ì¶œë ¥</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="pdf-container" class="hidden">
        <div id="pdf-content" class="p-16 text-black bg-white">
            <h1 class="text-center text-4xl font-bold mb-16 underline underline-offset-8 decoration-2">ë¬¼ í’ˆ ë°œ ì£¼ ì„œ</h1>
            <div class="flex justify-between mb-12 text-lg">
                <div class="space-y-2">
                    <p><strong>ë°œì‹ :</strong> (ì£¼)SKE</p>
                    <p><strong>ìˆ˜ì‹ :</strong> <span id="pdf-vendor" class="border-b border-black px-4 font-bold"></span> ê·€í•˜</p>
                </div>
                <div class="text-right">
                    <p><strong>ì¼ì:</strong> <span id="pdf-date"></span></p>
                    <p><strong>ë°œì£¼ë²ˆí˜¸:</strong> <span id="pdf-ref"></span></p>
                </div>
            </div>
            <table class="w-full border-collapse border-2 border-black">
                <thead><tr class="bg-gray-100"><th class="border border-black p-3">ìì¬ëª… (Project)</th><th class="border border-black p-3 w-32">ìˆ˜ëŸ‰</th><th class="border border-black p-3 w-24">ë‹¨ìœ„</th></tr></thead>
                <tbody id="pdf-items-body"></tbody>
            </table>
            <p class="text-center text-2xl mt-32 font-bold italic tracking-tighter">ìœ„ì™€ ê°™ì´ ë¬¼í’ˆì„ ì •íˆ ë°œì£¼í•©ë‹ˆë‹¤.</p>
            <p class="text-right text-xl mt-16 font-bold">(ì£¼) S K E  ê´€ë¦¬ì (ì¸)</p>
        </div>
    </div>

    <script>
        // âœ… SKE-0001 ì „ìš© ì„¤ì • (ë³´ë‚´ì£¼ì‹  index.html ê¸°ë°˜)
        const DATABASE_URL = "https://ske-0001-default-rtdb.firebaseio.com/";
        const DB_PATH = DATABASE_URL + "inventory.json";
        
        let fullInventory = [];
        let selectedItems = [];

        async function loadInventory() {
            const listDiv = document.getElementById('projectGroupList');
            try {
                const response = await fetch(DB_PATH);
                const data = await response.json();
                fullInventory = data ? Object.values(data) : [];
                
                // ğŸ’¡ í”„ë¡œì íŠ¸ëª…ë³„ë¡œ ìì¬ ë¬¶ê¸°
                const projects = [...new Set(fullInventory.map(i => i.project))].filter(p => p);
                listDiv.innerHTML = "";
                
                if(projects.length === 0) {
                    listDiv.innerHTML = "<div class='text-center py-10 text-slate-400'>í‘œì‹œí•  í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
                    return;
                }

                projects.forEach(pName => {
                    const el = document.createElement('div');
                    el.className = "p-4 border border-slate-100 rounded-xl cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all shadow-sm";
                    el.innerHTML = `<div><span class="text-[10px] text-blue-500 font-bold block mb-1">PROJECT</span><h4 class="font-black text-slate-700">${pName}</h4></div>`;
                    el.onclick = () => selectProject(pName);
                    listDiv.appendChild(el);
                });
            } catch (e) { listDiv.innerHTML = "DB ì—°ê²° ì˜¤ë¥˜"; }
        }

        function selectProject(pName) {
            selectedItems = fullInventory.filter(i => i.project === pName);
            document.getElementById('workArea').classList.remove('hidden');
            document.getElementById('selectedTitle').innerText = pName;
            document.getElementById('newOrderName').value = `${pName}_ë°œì£¼_${new Date().toLocaleDateString()}`;
            renderTable();
        }

        function renderTable() {
            const multi = parseInt(document.getElementById('multiplier').value) || 1;
            const body = document.getElementById('previewBody');
            body.innerHTML = selectedItems.map(i => `
                <tr class="hover:bg-white"><td class="p-4 font-bold text-slate-600">${i.item}</td><td class="p-4 text-right text-slate-400 font-mono">${i.targetQty}</td><td class="p-4 text-right font-black text-blue-600 font-mono text-lg">${i.targetQty * multi}</td></tr>
            `).join('');
        }

        function exportToPDF() {
            const multi = parseInt(document.getElementById('multiplier').value) || 1;
            document.getElementById('pdf-vendor').innerText = selectedItems[0].vendor || "í˜‘ë ¥ì‚¬";
            document.getElementById('pdf-date').innerText = new Date().toLocaleDateString();
            document.getElementById('pdf-ref').innerText = document.getElementById('newOrderName').value;
            document.getElementById('pdf-items-body').innerHTML = selectedItems.map(i => `
                <tr><td class="border border-black p-3 font-bold">${i.item} (${i.project})</td><td class="border border-black p-3 text-right font-bold text-lg">${i.targetQty * multi}</td><td class="border border-black p-3 text-center">ea</td></tr>
            `).join('');

            html2pdf().from(document.getElementById('pdf-content')).set({
                margin: 10, filename: `${document.getElementById('newOrderName').value}.pdf`,
                jsPDF: { format: 'a4', orientation: 'portrait' }
            }).save();
        }

        document.getElementById('multiplier').oninput = renderTable;
        loadInventory();
    </script>
</body>
</html>
