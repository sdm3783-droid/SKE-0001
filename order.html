<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SKE-0001 ë°œì£¼ì„œ ìƒì„± ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="p-6 text-slate-800">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 pb-6 border-b-2 border-slate-200">
            <div>
                <h2 class="text-2xl font-bold text-blue-800 border-l-8 border-blue-800 pl-4">ğŸ“¦ ë°˜ë³µ ë°œì£¼ ìƒì„± ì‹œìŠ¤í…œ</h2>
                <p class="text-slate-500 text-sm mt-1">ê¸°ì¡´ ì¸ë²¤í† ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë°œì£¼ì„œë¥¼ ìë™ ì‘ì„±í•©ë‹ˆë‹¤.</p>
            </div>
            <a href="index.html" class="px-5 py-2 bg-slate-200 hover:bg-slate-300 rounded-lg text-sm font-bold transition-all">â† ì¬ê³  í˜„í™©íŒìœ¼ë¡œ ì´ë™</a>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <aside class="lg:col-span-4">
                <div class="card p-6 border border-slate-200">
                    <h3 class="text-sm font-bold text-slate-400 mb-4 uppercase tracking-widest">Select Item Group</h3>
                    <div id="projectGroupList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                        <div class="text-center py-10 text-slate-400 animate-pulse text-sm">ë°ì´í„°ë¥¼ ë™ê¸°í™” ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
            </aside>

            <main id="workArea" class="lg:col-span-8 hidden">
                <div class="card border border-blue-100 overflow-hidden">
                    <div class="bg-blue-800 p-6 text-white flex justify-between items-center">
                        <h2 class="text-lg font-bold" id="selectedTitle">ë°œì£¼ ìƒì„¸ ì„¤ì •</h2>
                        <span class="text-xs bg-blue-700 px-3 py-1 rounded-full font-bold uppercase">Draft Mode</span>
                    </div>

                    <div class="p-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2">ë°œì£¼ì„œ ì œëª©</label>
                                <input type="text" id="newOrderName" class="w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2">ìˆ˜ëŸ‰ ë°°ìˆ˜ (Multiplier)</label>
                                <div class="flex items-center gap-4">
                                    <input type="number" id="multiplier" value="1" min="1" class="w-24 border border-slate-200 rounded-xl p-3 text-center font-bold text-blue-600 text-xl">
                                    <span class="text-slate-400 font-bold">ë°°ìˆ˜ ë°œì£¼</span>
                                </div>
                            </div>
                        </div>

                        <div class="border border-slate-100 rounded-2xl mb-8 overflow-hidden bg-slate-50">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-100 border-b border-slate-200 text-slate-500">
                                    <tr><th class="p-4">ìì¬ëª…</th><th class="p-4 text-right">ê¸°ë³¸í•„ìš”</th><th class="p-4 text-right text-blue-600 font-bold">ë°œì£¼ìˆ˜ëŸ‰</th></tr>
                                </thead>
                                <tbody id="previewBody" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="exportToPDF()" class="flex-1 bg-slate-900 hover:bg-black text-white font-bold py-4 rounded-xl shadow-lg transition-all">PDF ë°œì£¼ì„œ ì¶œë ¥</button>
                            <button onclick="alert('ë°ì´í„°ê°€ ë³´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤.')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all">ë‚´ì—­ ì €ì¥</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="pdf-template" class="hidden">
        <div id="pdf-content" class="p-16 text-black bg-white">
            <h1 class="text-center text-4xl font-bold mb-16 underline underline-offset-8">ë¬¼ í’ˆ ë°œ ì£¼ ì„œ</h1>
            <div class="flex justify-between mb-12 text-lg">
                <div>
                    <p><strong>ìˆ˜ì‹ :</strong> <span id="pdf-vendor" class="border-b border-black px-4 font-bold"></span> ê·€í•˜</p>
                    <p><strong>ì¼ì:</strong> <span id="pdf-date"></span></p>
                </div>
                <div class="text-right">
                    <p class="font-bold text-xl">(ì£¼) S K E</p>
                    <p class="mt-2 font-medium">ê´€ë¦¬íŒ€ ìì¬ë‹´ë‹¹</p>
                </div>
            </div>
            <table class="w-full border-collapse border-2 border-black">
                <thead><tr class="bg-gray-50"><th class="border border-black p-3">ìì¬ëª… (Project)</th><th class="border border-black p-3 w-32">ë°œì£¼ìˆ˜ëŸ‰</th><th class="border border-black p-3 w-24">ë‹¨ìœ„</th></tr></thead>
                <tbody id="pdf-items-body"></tbody>
            </table>
            <p class="text-center text-xl mt-32 font-bold italic text-gray-700">ìœ„ì™€ ê°™ì´ ë¬¼í’ˆì„ ì •íˆ ë°œì£¼í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        const DB_PATH = "https://ske-0001-default-rtdb.firebaseio.com/inventory.json";
        let fullInventory = [];
        let selectedItems = [];

        // 1. ê¸°ì¡´ í˜„í™©íŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadInventory() {
            const listDiv = document.getElementById('projectGroupList');
            try {
                const response = await fetch(DB_PATH);
                const data = await response.json();
                fullInventory = data ? Object.values(data) : [];
                
                // í”„ë¡œì íŠ¸ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ëª©ë¡ ìƒì„±
                const projectGroups = [...new Set(fullInventory.map(item => item.project))];
                listDiv.innerHTML = "";
                
                projectGroups.forEach(pName => {
                    const el = document.createElement('div');
                    el.className = "bg-white p-4 rounded-xl border border-slate-200 cursor-pointer hover:border-blue-500 hover:shadow-md transition-all";
                    el.innerHTML = `<h4 class="font-bold text-slate-800">${pName}</h4><p class="text-xs text-slate-400 mt-1">í¬í•¨ ìì¬ ë³µì‚¬í•˜ê¸°</p>`;
                    el.onclick = () => selectProject(pName);
                    listDiv.appendChild(el);
                });
            } catch (e) { listDiv.innerHTML = "ë°ì´í„° ì—°ê²° ì‹¤íŒ¨"; }
        }

        // 2. í”„ë¡œì íŠ¸ ì„ íƒ ì‹œ ìì¬ ë¦¬ìŠ¤íŠ¸ ì„¸íŒ…
        function selectProject(pName) {
            selectedItems = fullInventory.filter(i => i.project === pName);
            document.getElementById('workArea').classList.remove('hidden');
            document.getElementById('selectedTitle').innerText = `${pName} ìì¬ ì„¤ì •`;
            document.getElementById('newOrderName').value = `${pName}_ë°œì£¼_${new Date().toLocaleDateString()}`;
            renderTable();
        }

        // 3. ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸ í…Œì´ë¸” ë Œë”ë§
        function renderTable() {
            const multi = parseInt(document.getElementById('multiplier').value) || 1;
            const body = document.getElementById('previewBody');
            body.innerHTML = selectedItems.map(i => `
                <tr class="hover:bg-white transition">
                    <td class="p-4 font-bold text-slate-700">${i.item}<br><span class="text-[10px] text-slate-400 font-normal uppercase tracking-tighter">PO: ${i.order || '-'}</span></td>
                    <td class="p-4 text-right text-slate-400">${i.targetQty}</td>
                    <td class="p-4 text-right font-black text-blue-600 text-lg">${i.targetQty * multi}</td>
                </tr>
            `).join('');
        }

        // 4. PDF ì¶œë ¥
        function exportToPDF() {
            const multi = parseInt(document.getElementById('multiplier').value) || 1;
