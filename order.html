<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SKE-0001 ë„ë©´ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";</script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Pretendard', sans-serif; }
        .drop-zone { border: 3px dashed #334155; transition: 0.3s; background: #1e293b; }
        .drop-zone.active { border-color: #3b82f6; background: #1e3a8a; }
        .data-table th { background: #334155; color: #94a3b8; font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; }
        .data-table td { border-bottom: 1px solid #334155; }
        input { background: #0f172a; border: 1px solid #334155; color: #f8fafc; padding: 4px 8px; border-radius: 4px; }
    </style>
</head>
<body class="p-8">

    <div class="max-w-5xl mx-auto">
        <header class="mb-10 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-black text-blue-500 tracking-tighter">SKE-0001 <span class="text-white font-light text-xl ml-2">DRAWING PARSER</span></h1>
                <p class="text-slate-500 text-sm mt-1">ë„ë©´ PDFë¥¼ ë“œë˜ê·¸í•˜ì—¬ ìì¬ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
            </div>
            <a href="index.html" class="text-xs bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg transition">ë©”ì¸ìœ¼ë¡œ ì´ë™</a>
        </header>

        <div id="dropZone" class="drop-zone rounded-3xl p-16 text-center mb-10 cursor-pointer">
            <div class="text-5xl mb-4">ğŸ“„</div>
            <p class="text-xl font-bold text-white">ì—¬ê¸°ì— PDF ë„ë©´ íŒŒì¼ì„ ë“œë¡­í•˜ì„¸ìš”</p>
            <p class="text-slate-500 mt-2 text-sm">í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ PDF ë„ë©´ë§Œ ë¶„ì„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </div>

        <div id="resultArea" class="hidden">
            <div class="bg-slate-800 rounded-3xl p-8 shadow-2xl border border-slate-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold flex items-center">
                        <span class="w-2 h-6 bg-blue-500 rounded-full mr-3"></span> ì¶”ì¶œëœ BOM ë¦¬ìŠ¤íŠ¸
                    </h2>
                    <button onclick="saveToInventory()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl font-bold text-sm transition shadow-lg shadow-blue-900/50">
                        ì¸ë²¤í† ë¦¬ ì €ì¥ ë° ë™ê¸°í™”
                    </button>
                </div>

                <table class="w-full data-table">
                    <thead>
                        <tr>
                            <th class="p-4 text-left">ë¶„ë¥˜</th>
                            <th class="p-4 text-left">ìì¬ëª… / ê·œê²©</th>
                            <th class="p-4 text-right">ìˆ˜ëŸ‰(Q'TY)</th>
                            <th class="p-4 text-center">ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="bomBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const bomBody = document.getElementById('bomBody');
        const resultArea = document.getElementById('resultArea');

        // ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('active'); };
        dropZone.ondragleave = () => dropZone.classList.remove('active');
        dropZone.ondrop = async (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                processPDF(file);
            }
        };

        async function processPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const page = await pdf.getPage(1);
            const textContent = await page.getTextContent();
            
            // í•˜ë„¤ìŠ¤ ë„ë©´ íŠ¹í™” ì¶”ì¶œ ë¡œì§
            // ë„ë©´ í•˜ë‹¨(Yì¢Œí‘œê°€ ë‚®ì€ ê³³)ì— ìœ„ì¹˜í•œ í…ìŠ¤íŠ¸ë“¤ì„ ìš°ì„ ì ìœ¼ë¡œ ë¶„ì„
            const items = textContent.items.map(item => ({
                str: item.str.trim(),
                x: item.transform[4],
                y: item.transform[5]
            })).filter(item => item.str.length > 1);

            // í•˜ë„¤ìŠ¤ ë„ë©´ í‚¤ì›Œë“œ í•„í„°ë§ (CONNECTOR, CABLE, WIRE, LUG ë“±)
            const keywords = ['LUG', 'UL', 'AWG', 'WIRE', 'CABLE', 'IR3', 'M4', 'SOCKET'];
            const extractedBOM = [];

            items.forEach(item => {
                const found = keywords.some(k => item.str.toUpperCase().includes(k));
                if (found) {
                    extractedBOM.push({
                        type: item.str.includes('AWG') ? 'CABLE' : 'CONNECTOR',
                        name: item.str,
                        qty: 1 // ë„ë©´ì—ì„œ ìˆ˜ëŸ‰ ë§¤ì¹­ì€ ì¶”ê°€ ê³ ë„í™” í•„ìš”
                    });
                }
            });

            renderBOM(extractedBOM);
        }

        function renderBOM(data) {
            resultArea.classList.remove('hidden');
            bomBody.innerHTML = data.map((item, idx) => `
                <tr class="hover:bg-slate-700/50 transition">
                    <td class="p-4 text-slate-400 font-bold text-xs">${item.type}</td>
                    <td class="p-4"><input type="text" value="${item.name}" class="w-full"></td>
                    <td class="p-4 text-right"><input type="number" value="${item.qty}" class="w-20 text-right"></td>
                    <td class="p-4 text-center">
                        <button onclick="this.closest('tr').remove()" class="text-red-500 hover:text-red-400 text-xs font-bold">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }

        async function saveToInventory() {
            // Firebaseì˜ inventory.json ê²½ë¡œë¡œ ë°ì´í„° ì „ì†¡ ë¡œì§
            alert("ì¤€ë¹„ëœ ë°ì´í„°ë¥¼ ì¸ë²¤í† ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.");
        }
    </script>
</body>
</html>
