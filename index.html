<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‚¬ê¸‰ìì¬ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ (ì‚¬ì§„ë³´ê¸° í¬í•¨)</title>
    <style>
        :root { --primary: #1e40af; --bg: #f1f5f9; --warn: #dc2626; --part: #d97706; --success: #059669; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        #lockScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; color: white; }
        .lock-box { background: white; padding: 30px; border-radius: 12px; text-align: center; color: #333; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .container { max-width: 1700px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: none; }
        
        /* ì‚¬ì§„ íŒì—… ìŠ¤íƒ€ì¼ */
        #imgModal { display: none; position: fixed; z-index: 10000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
        .modal-content { background:white; padding:20px; border-radius:12px; max-width:400px; text-align:center; }
        .modal-content img { max-width:100%; border-radius:8px; border:1px solid #ddd; margin-bottom:10px; }
        
        .item-link { color: var(--primary); font-weight: bold; text-decoration: underline; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f1f5f9; padding: 12px; font-size: 12px; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; text-align: center; font-size: 13px; }
        .editable:hover { background: #fff9c4; cursor: pointer; }
        .edit-input { width: 90%; padding: 4px; border: 2px solid var(--primary); border-radius: 4px; text-align: center; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; width: 100%; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="lockScreen">
    <div class="lock-box">
        <h3>ğŸ” ê´€ë¦¬ì ì¸ì¦</h3>
        <input type="password" id="pwInput" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding:10px; margin-bottom:10px; text-align:center;"><br>
        <button class="btn btn-add" onclick="checkPW()">ì ‘ì†í•˜ê¸°</button>
    </div>
</div>

<div id="imgModal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 id="mTitle">ìì¬ ì‚¬ì§„</h3>
        <img id="mImg" src="" alt="ì‚¬ì§„ ì—†ìŒ">
        <div style="display:flex; gap:10px; justify-content:center;">
            <button class="btn" onclick="document.getElementById('imgModal').style.display='none'">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<div class="container" id="mainApp">
    <h2>ğŸ“Š ì‚¬ê¸‰ìì¬ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ <span id="syncStatus" style="font-size:12px; color:var(--success);">â— ì—°ê²°ë¨</span></h2>
    
    <div class="input-grid">
        <div style="display:flex; flex-direction:column;"><label style="font-size:11px;">ë“±ë¡ì¼ì</label><input type="date" id="pRegDate"></div>
        <input type="text" id="pName" placeholder="í”„ë¡œì íŠ¸ëª…">
        <input type="text" id="pOrder" placeholder="ë°œì£¼ë²ˆí˜¸">
        <input type="text" id="pVendor" placeholder="ì—…ì²´ëª…">
        <input type="text" id="pItem" placeholder="ìì¬ëª…">
        <input type="number" id="pTargetQty" placeholder="í•„ìš”">
        <input type="number" id="pInQty" placeholder="ì…ê³ " value="0">
        <input type="text" id="pRemark" placeholder="ë¹„ê³ ">
        <button class="btn btn-add" onclick="addItem()">ë°ì´í„° ë“±ë¡</button>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th>ë“±ë¡ì¼ì</th>
                <th>í”„ë¡œì íŠ¸ëª…</th>
                <th>ë°œì£¼ë²ˆí˜¸</th>
                <th>ì—…ì²´ëª…</th>
                <th>ìì¬ëª… (í´ë¦­:ì‚¬ì§„)</th>
                <th>í•„ìš”</th>
                <th>ì…ê³ </th>
                <th>ì”ì—¬</th>
                <th>ìƒíƒœ</th>
                <th>ë¹„ê³ </th>
                <th>ì‚­ì œ</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    const DATABASE_URL = "https://ske-0001-default-rtdb.firebaseio.com/"; // ë³¸ì¸ URLë¡œ ìœ ì§€
    const DB_PATH = DATABASE_URL + "inventory.json";
    const ADMIN_PW = "1234"; 

    let inventory = [];

    function checkPW() {
        if(document.getElementById('pwInput').value === ADMIN_PW) {
            document.getElementById('lockScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadData(); setInterval(loadData, 5000);
        } else { alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); }
    }

    async function loadData() {
        const res = await fetch(DB_PATH);
        const data = await res.json();
        inventory = data ? Object.values(data) : [];
        render();
    }

    async function saveData() {
        await fetch(DB_PATH, { method: 'PUT', body: JSON.stringify(inventory) });
        render();
    }

    function showPhoto(name) {
        document.getElementById('mTitle').innerText = name;
        const img = document.getElementById('mImg');
        img.src = `images/${name}.jpg`;
        img.onerror = () => { img.src = "https://via.placeholder.com/300?text=No+Image"; };
        document.getElementById('imgModal').style.display = 'flex';
    }

    function render() {
        const body = document.getElementById('tableBody');
        body.innerHTML = '';
        inventory.forEach((item, idx) => {
            const rem = item.targetQty - item.inQty;
            body.innerHTML += `
                <tr>
                    <td>${item.regDate}</td>
                    <td class="editable" onclick="editCell(${idx}, 'project', this)">${item.project}</td>
                    <td>${item.order}</td>
                    <td>${item.vendor}</td>
                    <td class="item-link" onclick="showPhoto('${item.item}')">${item.item}</td>
                    <td class="editable" onclick="editCell(${idx}, 'targetQty', this)">${item.targetQty}</td>
                    <td class="editable" onclick="editCell(${idx}, 'inQty', this)">${item.inQty}</td>
                    <td style="color:red; font-weight:bold;">${rem}</td>
                    <td>${rem <= 0 ? 'ì™„ë£Œ' : 'ë¯¸ì…ê³ '}</td>
                    <td class="editable" onclick="editCell(${idx}, 'remark', this)">${item.remark || '-'}</td>
                    <td><button onclick="deleteItem(${idx})">âŒ</button></td>
                </tr>`;
        });
    }

    async function addItem() {
        const item = {
            regDate: document.getElementById('pRegDate').value,
            project: document.getElementById('pName').value,
            order: document.getElementById('pOrder').value,
            vendor: document.getElementById('pVendor').value,
            item: document.getElementById('pItem').value,
            targetQty: parseInt(document.getElementById('pTargetQty').value) || 0,
            inQty: parseInt(document.getElementById('pInQty').value) || 0,
            remark: document.getElementById('pRemark').value,
            timestamp: Date.now()
        };
        inventory.push(item);
        await saveData();
    }

    function editCell(idx, field, el) {
        if(el.querySelector('input')) return;
        const val = inventory[idx][field];
        el.innerHTML = `<input type="text" class="edit-input" value="${val}" onblur="updateVal(${idx}, '${field}', this.value)">`;
        el.querySelector('input').focus();
    }

    async function updateVal(idx, field, val) {
        inventory[idx][field] = field.includes('Qty') ? parseInt(val) : val;
        await saveData();
    }

    async function deleteItem(idx) { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { inventory.splice(idx, 1); await saveData(); } }
</script>
</body>
</html>